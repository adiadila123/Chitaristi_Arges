            }
{% extends 'base.html' %}
{% load static %}

{% block title %}Galerie{% endblock %}

{% block content %}
    <link rel="stylesheet" href="{% static 'css/modal_slider.css' %}">
    <!-- Sectiunea pentru Galeria Foto si Video -->
    <section id="gallery" class="gallery-section py-5">
        <div class="container bg-lightgray" data-aos="fade-up" data-aos-duration="1500">
            <h2 class="gallery-title mb-5" data-aos="fade-down" data-aos-duration="1500">Galerii</h2>

            <!-- Separator -->
            <div class="separator-container">
                <i class="bi bi-images"></i>
            </div>
            <!-- Separator End -->

            <!-- Filter Buttons Start -->
            <div id="filter-buttons" class="mb-4">
                <a class="btn {% if type == 'photo' %}btn-active{% endif %}" href="?type=photo">Fotografii</a>
                <a class="btn {% if type == 'video' %}btn-active{% endif %}" href="?type=video">Videoclipuri</a>
            </div>
            <!-- Filter Buttons End -->

            <!-- Display Photos -->
            {% if type == 'photo' or type == 'all' %}
            <div class="photo-gallery">
                {% if photo_page_obj %}
                    {% for image in photo_page_obj %}
                    <div class="photo-item">
                        <a href="#" data-bs-toggle="modal" data-bs-target="#photoModal" data-image-url="{{ image.image.url }}" data-image-title="{{ image.title }}">
                            <div class="gallery-item-content">
                                <img src="{{ image.image.url }}" alt="{{ image.title }}" loading="lazy">
                                <div class="overlay">
                                    <i class="fas fa-search-plus"></i>
                                    <p>{{ image.uploaded_at|date:"j F Y" }}</p>
                                </div>
                            </div>
                        </a>
                    </div>
                    {% empty %}
                    <p>Nu sunt fotografii disponibile.</p>
                    {% endfor %}

                    <!-- Pagination Controls -->
                    <div class="container">
                        <div class="pagination-container pagination-sm text-center mt-4">
                            <nav aria-label="Page navigation">
                                <ul class="pagination">
                                    {% if photo_page_obj.has_previous %}
                                        <li class="page-item">
                                            <a class="page-link" href="?type=photo&photo_page={{ photo_page_obj.previous_page_number }}">Previous</a>
                                        </li>
                                    {% else %}
                                        <li class="page-item disabled">
                                            <a class="page-link">Previous</a>
                                        </li>
                                    {% endif %}

                                    {% for num in photo_page_obj.paginator.page_range %}
                                        <li class="page-item {% if photo_page_obj.number == num %}active{% endif %}">
                                            <a class="page-link" href="?type=photo&photo_page={{ num }}">{{ num }}</a>
                                        </li>
                                    {% endfor %}

                                    {% if photo_page_obj.has_next %}
                                        <li class="page-item">
                                            <a class="page-link" href="?type=photo&photo_page={{ photo_page_obj.next_page_number }}">Next</a>
                                        </li>
                                    {% else %}
                                        <li class="page-item disabled">
                                            <a class="page-link">Next</a>
                                        </li>
                                    {% endif %}
                                </ul>
                            </nav>
                        </div>
                    </div>
                    <!-- Pagination Controls End -->
                {% endif %}
            </div>
            <!-- Display Photos End -->
            {% endif %}

            <!-- Display Videos -->
            {% if type == 'video' or type == 'all' %}
            <div class="video-gallery">
                {% if video_page_obj %}
                    {% for video in video_page_obj %}
                    <div class="video-item">
                        <a href="#" data-bs-toggle="modal" data-bs-target="#videoModal" data-video-url="{{ video.video_url }}" data-video-title="{{ video.title }}">
                            <div class="gallery-item-content">
                                <img src="{% if video.thumbnail %}{{ video.thumbnail.url }}{% else %}{% static 'images/default-thumbnail.jpg' %}{% endif %}" alt="{{ video.title }}" loading="lazy">
                                <div class="overlay">
                                    <i class="fas fa-play-circle"></i>
                                    <p>{{ video.uploaded_at|date:"j F Y" }}</p>
                                </div>
                            </div>
                        </a>
                    </div>
                    {% empty %}
                    <p>Nu sunt videoclipuri disponibile.</p>
                    {% endfor %}

                    <!-- Pagination Controls -->
                    <div class="container">
                        <div class="pagination-container pagination-sm text-center mt-4">
                            <nav aria-label="Page navigation">
                                <ul class="pagination">
                                    {% if video_page_obj.has_previous %}
                                        <li class="page-item">
                                            <a class="page-link" href="?type=video&video_page={{ video_page_obj.previous_page_number }}">Previous</a>
                                        </li>
                                    {% else %}
                                        <li class="page-item disabled">
                                            <a class="page-link">Previous</a>
                                        </li>
                                    {% endif %}

                                    {% for num in video_page_obj.paginator.page_range %}
                                        <li class="page-item {% if video_page_obj.number == num %}active{% endif %}">
                                            <a class="page-link" href="?type=video&video_page={{ num }}">{{ num }}</a>
                                        </li>
                                    {% endfor %}

                                    {% if video_page_obj.has_next %}
                                        <li class="page-item">
                                            <a class="page-link" href="?type=video&video_page={{ video_page_obj.next_page_number }}">Next</a>
                                        </li>
                                    {% else %}
                                        <li class="page-item disabled">
                                            <a class="page-link">Next</a>
                                        </li>
                                    {% endif %}
                                </ul>
                            </nav>
                        </div>
                    </div>
                    <!-- Pagination Controls End -->
                {% endif %}
            </div>
            <!-- Display Videos End -->
            {% endif %}
        </div>
    </section>
    <!-- Sectiunea pentru Galeria Foto si Video -->

    <!-- Modal pentru Foto -->
    <div class="modal fade" id="photoModal" tabindex="-1" aria-labelledby="photoModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-fullscreen">
            <div class="modal-content">
                <!-- Modal Header -->
                <div class="modal-header">
                    <h5 class="modal-title" id="photoModalLabel">Galeria de Imagini</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <!-- Modal Header End -->

                <!-- Modal Body -->
                <div class="modal-body p-0">
                    <!-- Carousel -->
                    <div id="photoCarousel" class="carousel slide" data-bs-ride="carousel">
                          <!-- The slideshow/carousel -->
                          <div class="carousel-inner">
                            <!-- Slides will be added dynamically here -->
                          </div>
                        <!-- The slideshow/carousel End -->

                        <!-- Left and right controls/icons -->
                          <button class="carousel-control-prev" type="button" data-bs-target="#photoCarousel" data-bs-slide="prev">
                            <span class="carousel-control-prev-icon"></span>
                          </button>
                          <button class="carousel-control-next" type="button" data-bs-target="#photoCarousel" data-bs-slide="next">
                            <span class="carousel-control-next-icon"></span>
                          </button>
                        <!-- Left and right controls/icons End -->
                    </div>
                    <!-- Carousel End -->
                </div>
                <!-- Modal Body End -->
            </div>
        </div>
    </div>
    <!-- End Modal pentru Foto -->

    <!-- Modal pentru Video -->
    <div class="modal fade" id="videoModal" tabindex="-1" aria-labelledby="videoModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-fullscreen">
            <!-- Modal Content -->
            <div class="modal-content">
                <!-- Modal Header -->
                <div class="modal-header">
                    <h5 class="modal-title" id="videoModalLabel">Video</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <!-- Modal Header End -->

                <!-- Modal Body -->
                <div class="modal-body text-center p-0 ">
                    <div id="modalVideoContainer" class="embed-responsive embed-responsive-16by9">
                        <iframe id="modalVideo" src="" class="w-100" frameborder="0" allowfullscreen loading="lazy"></iframe>
                    </div>
                </div>
                <!-- Modal Body End -->
            </div>
            <!-- Modal Content End -->
        </div>
    </div>
    <!-- Modal pentru Video End -->

{% block extra_js %}
    <!-- Codul Java Script -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const photoLinks = document.querySelectorAll('.photo-item a');
            const videoLinks = document.querySelectorAll('.video-item a');

            const photoModal = new bootstrap.Modal(document.getElementById('photoModal'));
            const videoModal = new bootstrap.Modal(document.getElementById('videoModal'));

            const carouselInner = document.querySelector('#photoModal .carousel-inner');
            let images = [];
            let currentIndex = 0;

            // Initialize the photo modal when clicked
            photoLinks.forEach((link) => {
                link.addEventListener('click', function(event) {
                    event.preventDefault();
                    const imageUrl = this.getAttribute('data-image-url');
                   // const imageTitle = this.getAttribute('data-image-title');

                    // Collect all images in the gallery
                    images = Array.from(document.querySelectorAll('.photo-item a')).map(link => ({
                        url: link.getAttribute('data-image-url'),
                       // title: link.getAttribute('data-image-title')
                    }));

                    currentIndex = images.findIndex(image => image.url === imageUrl);
                    updateCarousel();
                                document.getElementById('photoModalLabel').textContent = imageTitle; // Set title
                    photoModal.show();
                });
            });

            // Update the carousel based on the current image index
            function updateCarousel() {
                carouselInner.innerHTML = ''; // Clear existing images

                images.forEach((image, index) => {
                    const item = document.createElement('div');
                    item.classList.add('carousel-item');
                    if (index === currentIndex) item.classList.add('active');

                    // Add AOS attribute
                item.setAttribute('data-aos', 'fade-in');
                item.setAttribute('data-aos-duration', index * 500); // Optional delay for each item

                    const img = document.createElement('img');
                    img.src = image.url;
                    img.classList.add('d-block', 'w-100');
                    img.alt = image.title; // Set the alt text to the image title
                    item.appendChild(img);

                    carouselInner.appendChild(item);
                });
            }

            // Handle Prev button click
            document.querySelector('#photoModal .carousel-control-prev')?.addEventListener('click', () => {
                currentIndex = (currentIndex > 0) ? currentIndex - 1 : images.length - 1;
                updateCarousel();
            });

            // Handle Next button click
            document.querySelector('#photoModal .carousel-control-next')?.addEventListener('click', () => {
                currentIndex = (currentIndex < images.length - 1) ? currentIndex + 1 : 0;
                updateCarousel();
            });

            // Handle video modal interactions
            videoLinks.forEach(link => {
                link.addEventListener('click', function(event) {
                    event.preventDefault();
                    const videoUrl = this.getAttribute('data-video-url');
                    const videoTitle = this.getAttribute('data-video-title');
                    const modalVideo = document.getElementById('modalVideo');
                    modalVideo.src = getVideoEmbed(videoUrl);
                    document.getElementById('videoModalLabel').textContent = videoTitle; // Set title
                    videoModal.show();
                });
            });

            // Function to get embedded video URL based on video URL
            function getVideoEmbed(url) {
                let embedUrl = '';
                if (url.includes('youtube.com')) {
                    const urlParams = new URLSearchParams(new URL(url).search);
                    const videoId = urlParams.get('v') || url.split('/').pop().split('?')[0];
                    if (videoId) {
                        embedUrl = `https://www.youtube.com/embed/${videoId}`;
                    }
                } else if (url.includes('youtu.be')) {
                    const videoId = url.split('/').pop().split('?')[0];
                    if (videoId) {
                        embedUrl = `https://www.youtube.com/embed/${videoId}`;
                    }
                } else if (url.includes('vimeo.com')) {
                    const videoId = url.split('/').pop();
                    if (videoId) {
                        embedUrl = `https://player.vimeo.com/video/${videoId}`;
                    }
                } else {
                    embedUrl = url; // Assuming direct video URL
                }
                return embedUrl;
            }

            // Clear the video src when the modal is hidden
            document.getElementById('videoModal').addEventListener('hidden.bs.modal', function() {
                const modalVideo = document.getElementById('modalVideo');
                modalVideo.src = ''; // Reset src to stop video playback
            });
        });
    </script>
{% endblock %}

{% endblock %}